template(name='nav')
    .ui.fluid.attached.borderless.invert.menu.topnav
        a.icon.item(href='/')
            i.big.link.yin.yang.grey.icon
        if currentUser
            a.icon.header.item.toggle_leftbar
                i.bars.large.icon
            if connected
                a.icon.item.set_root(href="/m/model" class="{{isActivePath '/m/model'}}")
                    i.database.icon
                if is_admin
                    // .item
                    //     .ui.green.header not connected
                // .icon.item
                //     i.wikipedia.icon
                // .icon.item
                //     i.reddit.icon
                // .icon.item
                //     i.video.icon
                // a.icon.item(href="/rentals")
                //     i.clock.icon
                a.icon.item(href="/shop")
                    i.store.icon
                a.icon.item(href="/users")
                    i.users.icon
                a.icon.item(href="/one")
                    i.circle.icon
            else
                .item
                    i.yin.yang.loading.big.grey.icon
                    +status    
        .right.menu
            if connected
                a.icon.item.post(title='add')
                    i.large.plus.icon
            if currentUser
                if connected
                    if unread_count
                        a.item.alerts.select_term(href="#" class=alert_toggle_class)
                            i.large.bell.icon
                            if unread_count
                                |#{unread_count}
                    else
                        a.icon.item(href="/inbox" class="{{isActiveRoute 'inbox'}}")
                            i.large.outline.bell.icon
            a.icon.item(href="/chat" title='chat') 
                i.chat.outline.large.icon
            // a.icon.item(href="/u/#{currentUser.username}/messages" class="{{isActivePath 'user_messages'}}" title="#{user.username} messages")
            if is_dev 
                .icon.item
                    i.large.code.icon
                
            if currentUser
                a.large.item(href="/u/#{currentUser.username}" class="{{isActiveRoute 'profile'}}")
                    //- i.large.user.large.icon
                    |{{money_format currentUser.points}}c
                    |&nbsp;
                    if currentUser.profile_image_id
                        img.ui.avatar.compact.image(src="{{c.url currentUser.profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                    else 
                        i.large.user.large.icon
                    strong.mobile.hidden #{currentUser.username}
                // a.icon.large.item.toggle_rightbar.select_term
                //     i.bars.large.icon
            else
                a.item(href="/login" title='login')
                    i.large.sign.in.icon
                    // |enter

template(name='footer')
    .ui.fluid.basic.attached.segment.footer
        .ui.container.stackable.grid
            .eight.wide.column
                .ui.header #{connect_status.connected}
                .ui.header #{connect_status.status}
                with currentUser
                    if is_dev
                        +textarea_edit key='notes' direct=true
                if is_dev    
                    //with current_user
                    //    +role_switcher
                    input.old_key(type='text' placeholder='old key')
                    input.new_key(type='text' placeholder='new key')
                    .ui.button.submit_rename submit
            .eight.wide.column
                unless currentUser
                    a.ui.big.basic.button(href='/login')
                        i.sign.in.icon
                        |login
                if is_eric
                    with currentUser
                        +role_switcher
                        //+tribe_switcher
                else if is_dev
                    with currentUser
                        +role_switcher
        if is_user
            .row
                .ui.center.aligned.inverted.header
                    i.copyright.outline.icon
                    |dao
template(name='role_switcher')
    .ui.segment
        .ui.grey.inline.center.aligned.small.header 
            //- +i name='anonymous-mask'
            i.shield.icon(title='role switcher')
            |#{username} role switcher
        if is_eric
            //- +user_array_element_toggle key='roles' value='dev' user=currentUser
            +multi_doc_edit key='roles' label='roles' ref_model='role' direct=true
        if current_user
            with current_user
                +multi_doc_edit key='roles' label='roles' ref_model='role' direct=true
        //- +user_array_element_toggle key='roles' value='dev' user=currentUser
        //- +user_array_element_toggle key='roles' value='user' user=currentUser
        //- +user_array_element_toggle key='roles' value='staff' user=currentUser
        //- +user_array_element_toggle key='roles' value='resident' user=currentUser
        //- +user_array_element_toggle key='roles' value='owner' user=currentUser




template(name='chatpop')
    if viewing_chat
        .chatpop.invert
            .ui.invert.pointer.grey.header.close_chat 
                i.chat.icon
                |chat
            .ui.large.list.smallscroll
                each last_messages
                    .item #{body}
                        small #{when}
            .ui.fluid.icon.transparent.input 
                i.plus.icon
                input.add_chat(type='text' placeholder='chat...')
    else 
        .ui.large.circular.icon.invert.button.open_chat
            i.chat.outline.large.icon

template(name='topbar')
    .ui.fluid.large.attached.segment
        .ui.middle.aligned.divided.list
            each recent_alerts
                +recent_alert
        a.ui.icon.attached.basic.button.item.close_topbar(href="/inbox")
            i.inbox.large.icon
            |inbox
        
template(name='recent_alert')        
    .item.alert
        .right.floated.content
            i.circular.eye.link.large.icon.mark_read(title='mark read')
        img.ui.avatar.image(src="{{c.url author.profile_image_id height=200 width=200 gravity='face' crop='fill'}}")
        .content
            .header
                |#{description} 
            .description #{author.name} #{made_when}
            
            
            
            
template(name='rightbar')
    .ui.right.sidebar.vertical.borderless.invert.menu
        // a.item.toggle_rightbar(href="/u/#{currentUser.username}" class="{{isActiveRoute 'user_layout'}}")
        //     img.ui.avatar.compact.image(src="{{c.url 'homestar_logo' height=200 width=200 gravity='face' crop='fill'}}")
        //     |#{currentUser.name}
        a.item.toggle_rightbar(href="/u/#{currentUser.username}/" class="{{isActiveRoute 'user_dashboard'}}")
            | dashboard (#{currentUser.points}p)
            i.large.dashboard.icon
        
        a.item.toggle_rightbar(href="/u/#{currentUser.username}/about" class="{{isActiveRoute 'user_about'}}")
            | about
            i.large.info.icon
        a.item.toggle_rightbar(href="/u/#{currentUser.username}/kin" class="{{isActiveRoute 'kin'}}")
            | #{currentUser.total_credit_amount}p received
            i.large.chevron.down.icon
        a.item.toggle_rightbar(href="/u/#{currentUser.username}/kout" class="{{isActiveRoute 'user_sent'}}")
            | #{currentUser.total_debit_amount}k out
            i.large.chevron.up.icon
        a.item.toggle_rightbar(href="/u/#{currentUser.username}/events" class="{{isActiveRoute 'user_events'}}")
            | events
            i.large.calendar.icon
        a.item.toggle_rightbar(href="/u/#{currentUser.username}/requests" class="{{isActiveRoute 'user_requests'}}")
            | requests
            i.large.concierge.bell.icon
        a.item.toggle_rightbar(href="/u/#{currentUser.username}/orders" class="{{isActiveRoute 'user_orders'}}")
            | orders
            i.large.cart.icon
        a.item.toggle_rightbar(href="/u/#{currentUser.username}/offers" class="{{isActiveRoute 'user_offers'}}")
            | offers
            i.large.hand.holding.heart.icon
        // a.item.toggle_rightbar(href="/u/#{currentUser.username}/messages" class="{{isActiveRoute 'user_messages'}}")
        //     | chat
        //     i.chat.icon
        .ui.divider
        a.item.toggle_rightbar(href="/u/#{currentUser.username}/edit" title='edit your account')
            i.cog.large.icon
            |settings
        // a.item.toggle_nightmode.toggle_rightbar(href="#")
        //     i.lightbulb.large.icon
        //     |dark mode
        a.item.logout(href="/u/#{currentUser.username}/messages" class="{{isActiveRoute 'user_messages'}}" )
            |logout
            if is_logging_out
                i.refresh.loading.icon
            else
                i.sign.out.icon



template(name='leftbar')
    .ui.left.sidebar.vertical.borderless.invert.menu
        // a.item.toggle_leftbar(href="/" class="{{isActiveRoute '/'}}")
        //     img.ui.avatar.compact.image(src="{{c.url 'homestar_logo' height=200 width=200 gravity='face' crop='fill'}}")
        //     |One
        a.item.toggle_leftbar(href="/" class="{{isActivePath '/'}}")
            i.dashboard.icon
            | Dashboard
        a.item.toggle_leftbar(href="/u/#{currentUser.username}" class="{{isActiveRoute 'user_dashboard'}}")
            i.user.icon
            | Profile
        a.item.toggle_leftbar(href="/finance" class="{{isActivePath '/finance'}}")
            i.money.icon
            | Finance
        a.item.toggle_leftbar(href="/settings" class="{{isActivePath '/settings'}}")
            i.cog.icon
            | Settings
        .divider
        a.disabled.item.toggle_leftbar(href="/chat" class="{{isActivePath '/chat'}}" title='chat') 
            |Chat
            i.chat.icon
        a.disabled.item.toggle_leftbar(href="/chat" class="{{isActivePath '/chat'}}" title='chat') 
            |Leads
            i.telephone.icon
        a.item.toggle_leftbar(href="/projects" class="{{isActivePath '/projects'}}" title='chat') 
            |Projects
            i.tasks.icon
        a.disabled.item.toggle_leftbar(href="/chat" class="{{isActivePath '/chat'}}" title='chat') 
            |Invoices
            i.invoice.icon
        if is_eric
            a.icon.item.toggle_dev.toggle_leftbar
                |toggle dev
                if is_dev
                    i.code.blue.large.icon
                else
                    i.code.large.icon
        if is_in_admin
            a.icon.item.toggle_admin.toggle_leftbar
                |toggle admin
                if is_admin
                    i.shield.blue.large.icon
                else
                    i.shield.large.icon
            
        if is_admin
            // a.item.toggle_leftbar.set_badge(href="/m/badge" class="{{isActivePath 'badges'}}")
            //     i.certificate.blue.icon
            //     | badges
            // a.item.toggle_leftbar.set_debit(href="/m/debit" class="{{isActivePath regex='rentals'}}")
            //     i.gift.blue.icon
            //     |gifts
            .divider
            // a.item.toggle_leftbar.set_project(href="/m/project" class="{{isActivePath regex='projects'}}")
            //     i.tasks.blue.icon
            //     | projects
            // a.item.toggle_leftbar(href="/m/room" class="{{isActiveRoute 'requests'}}")
            //     i.building.blue.icon
            //     |rooms
            a.blue.item.set_model.toggle_leftbar(href="/m/model" class="{{isActivePath '/m/model'}}")
                |admin
                i.database.blue.icon
            a.item.set_user.toggle_leftbar(href="/m/user" class="{{isActiveRoute '/m/user'}}")
                i.blue.users.icon
                | all users


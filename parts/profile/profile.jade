template(name='profile_layout')
    +status
    +nav
    .ui.bottom.attached.pushable.segment
        // +topbar
        // +left_sidebar
        +right_sidebar
                
        #main_area.global_container.pusher
            with user
                .ui.stackable.padded.grid
                    .four.wide.column
                        span.mobile.only
                            a(href="/u/#{username}/")
                                img.ui.centered.tiny.inline.spaced.image(src="{{c.url profile_image_id height=500 width=500 gravity='face' crop='fill'}}")
                        span.mobile.hidden
                            a(href="/u/#{username}/")
                                img.ui.centered.fluid.image(src="{{c.url profile_image_id height=500 width=500 gravity='face' crop='fill'}}") 
                        a.ui.header.refresh_user_stats(href="/u/#{username}") 
                            |#{name}
                        // div
                        a.ui.small.header.refresh_user_stats(href="/u/#{username}") 
                            |@#{username}
                        .ui.inline.header() #{points}pts
                        .ui.basic.label {{to_percent one_ratio}}% ratio
                        .ui.basic.label #{flow_volume} volume
                        .ui.basic.label #{profile_views} views
                        if is_admin
                            a.ui.basic.button(href="/u/#{username}/edit" title='admin edit account')
                                i.shield.large.icon
                                |account
                        if is_current_user
                            a.ui.basic.button(href="/u/#{username}/edit" title='edit your account')
                                i.cog.icon
                                |account
                            a.ui.basic.button.logout(href="#" title='log out')
                                i.sign.out.icon
                                |log out
                        if is_dev
                            .ui.small.inline.header #{_id}
                        unless is_current_user
                            if currentUser
                                // div
                                +user_friend_button 
                        unless is_current_user
                            .ui.basic.button.tip(title='send tip')
                                i.large.dollar.green.icon
                                span tip
                        if i_have_points
                            .ui.basic.button.send(title='send points')
                                i.red.gift.large.icon
                                span send pts
                        else
                            .ui.disabled.basic.button(title='send points')
                                i.red.gift.large.icon
                                span send pts
                        with data
                            .ui.list
                                .item #{total_karma} total karma
                                .item #{comment_karma} comment karma
                                .item #{link_karma} link karma
                                .item #{awardee_karma} awardee karma
                                .item #{awarder_karma} awarder karma
                                .item created {{ufrom created_utc}}
                                
                    .twelve.wide.column
                        a.ui.basic.compact.button.select_term.no_blink(href="/u/#{username}/" class="{{isActiveRoute 'user_dashboard'}}" title="#{user.username} dashboard")
                            i.large.dashboard.icon
                            span dashboard
                        a.ui.basic.compact.button.select_term.no_blink(href="/u/#{username}/posts" class="{{isActiveRoute 'user_posts'}}" title="#{user.username} posts")
                            i.newspaper.large.icon
                            span posts
                        a.ui.basic.compact.button.select_term.no_blink(href="/u/#{username}/comments" class="{{isActiveRoute 'user_comments'}}" title="#{user.username} comments")
                            i.chat.large.icon
                            span comments
                        a.ui.basic.compact.button.select_term.no_blink(href="/u/#{username}/credits" class="{{isActiveRoute 'user_credits'}}" title="#{user.username} credits")
                            i.large.chevron.down.icon
                            span pts received
                        a.ui.basic.compact.button.select_term.no_blink(href="/u/#{username}/sent" class="{{isActiveRoute 'user_sent'}}" title="#{user.username} sent")
                            i.large.gift.icon
                            span pts sent
                        a.ui.basic.compact.button.select_term.no_blink(href="/u/#{username}/credit" class="{{isActiveRoute 'user_credit'}}" title="#{user.username} credit")
                            i.large.dollar.icon
                            span credit
                        a.ui.basic.compact.button.select_term.no_blink(href="/u/#{username}/friends" class="{{isActiveRoute 'user_friends'}}" title="#{user.username} friends")
                            i.users.large.icon
                            span friends
                        a.ui.basic.compact.button.select_term.no_blink(href="/u/#{username}/vault" class="{{isActiveRoute 'user_vault'}}" title="#{user.username} friends")
                            i.lock.large.icon
                            span vault
                        if is_dev
                            +print_this
                        .ui.hidden.divider
                        .profile_yield
                            +yield    
                      





template(name='user_friend_button')
    if is_friend
        .ui.black.animated.fade.button.unfriend(title='unfriend')
            .hidden.content
                i.minus.large.icon
                |unfriend
            .visible.content
                i.checkmark.large.icon
                |friends
    else
        .ui.animated.fade.basic.button.friend(title='friend')
            .hidden.content
                i.plus.large.icon
                |friend
            .visible.content
                i.user.plus.large.icon
                |friend


template(name='user_dashboard')
    .ui.stackable.grid
        .row
            .sixteen.wide.column
                .ui.fluid.icon.input
                    i.plus.icon
                    input.add_feed_item(type='text' placeholder='add to feed (-10p)')
                .ui.circular.icon.button 
                    i.gift.icon
                .ui.circular.icon.button 
                    i.photo.icon
                .ui.circular.icon.button 
                    i.hand.holding.icon
                .ui.feed
                    each feed_items 
                        .event 
                            .label 
                                img.ui.avatar.compact.image(src="{{c.url _author.profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                            .content
                                .summary
                                    a.user #{_author.username}
                                    |#{body}
                                    .date
                                        |#{when}
                                .meta 
                                    a.like 
                                        i.like.icon
                if currentUser
                
                    // .ui.small.header 
                    //     label goto/create group
                    // .ui.input
                    //     input.goto_group(type='text' placeholder='name')
                    // each group_bookmarks
                    //     .ui.basic.large.label
                    //         i.remove.icon.remove_group
                    //         span.pointer.click_group
                    //             |#{name}
                    //- .ui.icon.button.refresh_user_stats(title='refresh stats')
                    //-     i.refresh.icon
                    .ui.basic.label #{user_post_count} posts x 10p = #{post_points}p
                    i.minus.icon
                    .ui.basic.label #{user_comment_count} comments x 1p
                    i.minus.icon
                    .ui.basic.label #{user_comment_count} tips sent totaling #{tips_sent_amount}
                    i.plus.icon
                    .ui.basic.label #{tips_received_count} tips received totaling #{tips_received_amount}
                    i.equals.icon
                    .ui.big.basic.label #{points}p
                    .ui.header 
                        i.chat.icon
                        |comments
                    .smallscroll
                        each comments    
                            +user_comment_small
                    div
                    .ui.inline.header 
                        i.newspaper.icon
                        |posts
                    +session_select key='post_sort_key' value='viewer_ids' icon='eye'
                    +session_select key='post_sort_key' value='points' icon='thumbs up'
                    +session_select key='post_sort_key' value='_timestamp' icon='clock'
                    .ui.link.list.smallscroll
                        each posts
                            +user_post_small
                    .ui.header 
                        i.donate.icon
                        |tips
                    .ui.link.list.smallscroll
                        each tips
                            +user_tip_small
        .three.column.row
            .column
                a.ui.inline.header(href="/u/#{username}/credits")
                    i.chevron.down.large.icon
                    |#{total_credit_amount}p
                    // |received
                    small(title='received count') (#{credit_count}x) 
                    small(title='rank') ##{global_credit_count_rank}
                i.tags.icon(title='credit tags')
                each credit_tags
                    .ui.small.basic.label #{title}
                        // small #{count}
                .medscroll.ui.segments
                    each user_credits
                        +user_credit_segment
            .column
                a.ui.inline.spaced.header(href="/u/#{username}/debits")
                    i.chevron.up.icon
                    |#{total_debit_amount}p
                    // |sent
                    small(title='debit count') (#{debit_count}x)
                    small(title='rank') ##{global_debit_count_rank}
                i.tags.icon(title='credit tags')
                each debit_tags
                    .ui.small.basic.label #{title} 
                        // small #{count}
    
                div
                .medscroll.ui.segments
                    each user_debits
                        +user_debit_segment
            .column
                +user_bookmarks_widget

template(name='session_select')
    .ui.icon.circular.button
        i.icon(class=icon)


template(name='user_posts')
    .ui.header 
        i.newspaper.icon
        |posts
    .ui.link.list
        each posts
            a.ui.item(href="/p/#{_id}") 
                .content
                    .header #{title} 
                    |#{when}
                    each seven_tags 
                        .ui.mini.basic.label #{this}


template(name='user_comments')
    .ui.header 
        i.comment.icon
        |comments
    .ui.link.list
        each comments
            a.ui.item(href="/p/#{parent_id}") 
                .content
                    .header #{body} 
                    |#{when}
                    each five_tags 
                        .ui.mini.basic.label #{this}



template(name='user_tip_small')
    a.ui.item(href="/tip/#{_id}/view") 
        |#{title} #{when} #{amount} #{parent_id}
        each tags 
            .ui.mini.basic.label #{this}

template(name='user_comment_small')
    |#{body}
template(name='user_post_small')
    .ui.fluid.link.card.mark_read.pad
        .content
            a.header(href="/p/#{_id}/view") 
                |#{title}
            |#{when}
            if image_link
                a.view_post(href="/p/#{_id}/view" class=post_header_class)
                    img.ui.rounded.inline.zoomer.image.zoomer(src=image_link)    
            // |!{content}
            i.grey.eye.icon
            each viewer_ids
                .ui.label #{this}
            |#{points}
            each five_tags
                .ui.small.basic.label #{this}
            +doc_emotion_small        
            // +skve k='view_preview' v='preview' l=' ' i='caret down'
            // if skv_is 'view_preview' 'preview'
            a.ui.large.icon.circular.button(href="/p/#{_id}/view") 
                i.chevron.right.icon
            if in_dev
                +print_this

template(name='user_bookmarks_widget')
    a.ui.header(href="/u/#{username}/bookmarks")
        i.bookmark.icon(title='bookmark tags')
        |bookmarks
    each bookmark_tags
        .ui.small.basic.label #{title} 
    div
    .medscroll.ui.segments
        each user_bookmark_docs
            .ui.header #{title}



template(name='user_credit_segment')
    .ui.segment.user_credit_segment.pointer.zoom
        .header
            strong #{amount}pt 
            // |from 
            if author.profile_image_id
                img.ui.avatar.image(src="{{c.url author.profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            |#{_author.shortname}
        small #{when}
        div
        |#{description}
        div
        each tags
            .ui.mini.basic.label #{this}


template(name='user_debit_segment')
    .ui.segment.user_debit_segment.pointer.zoom
        .header
            strong #{amount}pt
            | to 
            if recipient.profile_image_id
                img.ui.avatar.image(src="{{c.url recipient.profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            |#{recipient.shortname}
        small #{when}
        div
        |#{description}
        div
        each tags
            .ui.mini.basic.label #{this}

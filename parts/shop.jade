template(name='shop')
    .ui.padded.stackable.grid 
        .row
            .three.wide.column
                .ui.inline.header 
                    i.big.shop.icon
                    |shop
                .ui.large.icon.basic.circular.button.add_item
                    i.plus.icon
                // i.large.clock.icon
                // i.large.thumbs.up.icon
                .ui.icon.transparent.input
                    // if is_loading
                    //     i.yin.yang.loading.icon
                    // else
                    i.search.icon
                    input.search_tag(type='text' value=query)
                    // .ui.label #{this}
                
                if picked_tags
                    // if many_tags
                    //     a#clear_tags.ui.red.invert.icon.compact.button.pick_term
                    //         i.remove.icon
                    each picked_tags
                        +unpick_tag
                each result_tags
                    // .ui.label #{this}
                    +tag_picker
                        
            .thirteen.wide.column
                div(class=main_column_class)
                    // .ui.disabled.button shared with me
                    if skv_is 'view_sidebar' false
                        .ui.icon.compact.basic.circular.button.enable_sidebar
                            i.ellipsis.vertical.icon
                    else
                        .ui.icon.compact.active.circular.button.disable_sidebar
                            i.ellipsis.vertical.icon
                    if skv_is 'sort_direction' 1
                        .ui.icon.compact.basic.button.sort_down
                            i.caret.down.icon
                    else
                        .ui.icon.compact.basic.button.sort_up
                            i.caret.up.icon
                    .ui.compact.large.icon.basic.button.sort_created(class=sort_created_class)
                        i.clock.icon
                    .ui.compact.large.icon.basic.button.sort_ups(class=sort_ups_class)
                        i.thumbs.up.icon
                    if skv_is 'view_detail' true
                        .ui.black.large.icon.compact.basic.button.toggle_detail
                            i.list.icon
                    else
                        .ui.compact.large.icon.basic.button.toggle_detail
                            i.minus.icon
                        // i.line.chart.icon
                    if skv_is 'view_layout' 'grid'
                        .ui.compact.large.icon.black.button.set_grid(class=grid_class) 
                            i.th.icon
                    else
                        .ui.compact.large.icon.basic.button.set_grid(class=grid_class) 
                            i.th.icon
                    if skv_is 'view_layout' 'list'
                        .ui.compact.black.icon.large.button.set_list(class=list_class)
                            i.list.icon
                    else
                        .ui.compact.large.icon.basic.button.set_list(class=list_class)
                            i.list.icon
                    .ui.circular.icon.basic.button.skip_left
                        i.chevron.left.icon
                    .ui.circular.icon.basic.button.skip_right
                        i.chevron.right.icon
                    .ui.icon.button
                        i.film.icon
                    .ui.icon.button
                        i.picture.icon
                    .ui.icon.button
                        i.chat.icon            
                    .ui.input
                        input(type='text' )
            
                .ui.stackable.centered.four.cards
                    each shop_items
                        +shop_item
                        
template(name='shop_item')
    a.card(href="/s/#{_id}")
        img.ui.image(src="{{c.url image_id height=200 width=200}}" class=currentUser.invert_class)
        if image_link
            img.ui.image(src=image_link class=currentUser.invert_class)
        .content
            .header
                |#{title} 
            |#{when} 
            unless anon
                +author_info
            |#{description} #{body}
            .ui.inline.header #{price}p
            // if has_enough
        .content
            |#{inventory} left
            if can_buy
                .ui.circular.basic.button.buy
                    |buy

                    
template(name='shop_view')
    with current_doc
        .ui.stackable.grid
            .row 
                .twelve.wide.column.scrolling
                    a.ui.circular.basic.large.icon.button(href="/shop")
                        i.chevron.left.large.icon
                        i.large.shop.icon
                    .ui.center.aligned.inline.header #{title}
                    if image_link
                        +image_link_view key='image_link' direct=true
                    if image_id
                        img.ui.fluid.rounded.image.no_left(src="{{c.url image_id }}" class=currentUser.invert_class)
                    if youtube_id
                        .no_left
                            +youtube_view key='youtube_id' label='youtube id' direct=true
                    if raw 
                        |!{raw}
                    .say_this.say_body.f11
                        |!{content}
                    div 
                    .spacer
                    .spacer
                    +comments
                    div
                    +post_bounties
                    div
                    .ui.header 
                        i.receipt.icon
                        |#{receipts.length} receipts
                    each receipts
                        .ui.segment
                            .ui.inline.header purchased at #{purchase_price}
                            .ui.inline.small.header #{when}
                            .ui.basic.button.return
                                i.reply.icon
                                |return
                            if is_author
                                +text_edit key='notes' direct=true
                                +anon_toggle
                            unless anon
                                +author_info
                .four.wide.column.scrolling
                    if can_buy
                        .ui.large.green.button.buy
                            |buy for #{price}p
                    else
                        .ui.large.green.disabled.button.buy
                            |buy for #{price}p
                    .ui.header #{inventory} 
                        if unit_name
                            |#{unit_name}
                        else
                            |#{left}
                    a.ui.circular.basic.large.button(href="/shop")
                        i.chevron.left.large.icon
                        i.large.shop.icon
                    if can_edit 
                        a.ui.icon.large.circular.basic.button(href="/s/#{_id}/edit")
                            i.big.pencil.icon
                    +array_edit key='tags' label='tags' direct=true
                    +link_view key='link' label='link' direct=true
                    +array_view key='time_tags' label='time tags' icon='clock' direct=true
                    +array_view key='location_tags' label='location tags' icon='marker' direct=true
                    i.large.eye.icon
                    | #{views} views
                    each viewer_ids
                        +user_info
                    +tip
                    // .ui.header anon vote
                    // i.large.thumbs.up.icon.anon_voteup
                    // i.large.thumbs.down.icon.anon_votedown
                    div
                    if currentUser
                        +voting_full
                        // i.large.thumbs.up.icon.voteup
                        // i.large.thumbs.down.icon.anon_votedown
                        
                    
   
                    
                    
template(name='shop_edit')
    with current_doc
        .ui.stackable.grid
            .row
                .four.wide.column.scrolling
                    a.ui.icon.circular.green.big.button(href="/s/#{_id}" title='save')
                        i.checkmark.big.icon
                    .ui.inline.header 
                        i.pencil.icon
                        | shop
                    i.large.link.remove.icon.delete_shop
                    div 
                    +array_edit key='tags' label='tags' direct=true
                    // +raw_edit key='raw' label='raw' direct=true
                    +boolean_edit key='private' label='private' direct=true
                    +text_edit key='group' label='group' direct=true
                    +boolean_edit key='anon' label='anon' direct=true
                .twelve.wide.column.scrolling
                    // +boolean_edit key='has_title' icon='text' label='title'
                    +boolean_edit key='has_html' icon='content' label='content'
                    +boolean_edit key='has_image_link' icon='image' label='image link'
                    +boolean_edit key='has_image_upload' icon='image' label='image upload'
                    +boolean_edit key='has_youtube' icon='youtube' label='youtube'
                    +boolean_edit key='has_link' icon='link' label='link'
                    // +boolean_edit key='can_buy' icon='shop' label='can buy'
                    // if has_title
                    +text_edit key='title' label='title' direct=true
                    if has_html
                        +html_edit key='content' label='content' direct=true
                    if has_image_link
                        +image_link_edit key='image_link' direct=true
                    if has_youtube
                        +youtube_edit key='youtube_id' label='youtube id' direct=true
                    if has_link
                        +link_edit key='link' label='link' direct=true
                    if has_location_tags
                        +array_edit key='location_tags' label='location tags' icon='marker' direct=true
                    if has_time_tags
                        +array_edit key='time_tags' label='time tags' icon='clock' direct=true
                    if has_image_upload
                        +image_edit key='image_id' label='image' direct=true
                    // if can_buy
                    +text_edit key='unit_name' label='unit name'
                    +number_edit key='price' label='karma price'
                    +number_edit key='inventory' label='inventory'